group = 'mft-logger'
version = '1.0.0'

task readFileContentAndUpload() {

    	println "Executing Read and File Upload to MFT task..."

    	//Read the File which have the template of the project MFT.
    	def filename = 'projects/mft-logger-1.xml'
    
	// read all the content of the file into a single string
	File file = new File(filename);
	def fileContent = file.getText('UTF-8');

        println "File Content: " + fileContent; 

        String encodedFileContent = fileContent.bytes.encodeBase64().toString();

	println "File Content Encoded: " + encodedFileContent;

        //Execute the REST call of Import project to MFT Server        

        def jsonString = '{"importParameters" : { "file": "' + encodedFileContent + '","domain":"Default","ignoreCompileErrors":"true","replaceProject":"true","createTargetFolder":"true","targetFolder" : "/"}}';

	// POST
	def post = new URL("http://127.0.1.1:18000/goanywhere/rest/gacmd/v1/projects").openConnection();
	def message = jsonString;
	post.setRequestMethod("POST")
	post.setDoOutput(true)
	post.setRequestProperty("Content-Type", "application/json")
	post.setRequestProperty("Authorization", "Basic YWRtaW5pc3RyYXRvcjpnb2FueXdoZXJl")
	post.getOutputStream().write(message.getBytes("UTF-8"));
	def postRC = post.getResponseCode();
	println(postRC);
	if(postRC.equals(201)) {
	    println("Successfully MFT Project Created or Updated");
	}
	
}
